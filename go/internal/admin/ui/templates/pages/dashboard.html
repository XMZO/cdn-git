{{define "dashboard"}}
  <div class="grid">
    <div class="card">
      <h2>{{.Title}}</h2>
      <div class="muted small">{{.T "dashboard.configUpdatedAt"}}：{{.UpdatedAt}}</div>

      <div class="btn-row">
        <a class="btn" href="/wizard">{{.T "nav.wizard"}}</a>
        <a class="btn" href="/config/torcherino">{{.T "common.configure"}} {{.T "nav.torcherino"}}</a>
        <a class="btn" href="/config/cdnjs">{{.T "common.configure"}} {{.T "nav.cdnjs"}}</a>
        <a class="btn" href="/config/git">{{.T "common.configure"}} {{.T "nav.git"}}</a>
        <a class="btn" href="/config/versions">{{.T "nav.versions"}}</a>
        {{if .AdminURL}}<a class="btn" href="{{.AdminURL}}/_hazuki/health" target="_blank" rel="noreferrer">{{.T "dashboard.adminHealth"}}</a>{{end}}
      </div>
    </div>

    <div class="grid cols-3">
      <div class="card">
        <h3>Torcherino</h3>
        <div class="muted small">{{.T "common.port"}}：<code>{{.Ports.Torcherino}}</code></div>
        <div class="muted small" style="margin-top:8px;">{{.T "common.address"}}：<code>{{.TorcherinoURL}}</code></div>
        {{if .TorcherinoStatus.Status}}
          <div style="margin-top:8px;">
            {{template "serviceStatusPill" (statusCtx $ .TorcherinoStatus)}}
            {{if and (eq .TorcherinoStatus.Status "error") .TorcherinoStatus.Error}}
              <span class="muted small" style="margin-left:8px;">{{.TorcherinoStatus.Error}}</span>
            {{end}}
          </div>
        {{end}}
        <div class="btn-row">
          <a class="btn" href="/config/torcherino">{{.T "common.configure"}}</a>
          <a class="btn" href="{{.TorcherinoURL}}" target="_blank" rel="noreferrer">{{.T "common.open"}}</a>
          <a class="btn" href="{{.TorcherinoHealthURL}}" target="_blank" rel="noreferrer">{{.T "common.health"}}</a>
        </div>
      </div>

      <div class="card">
        <h3>{{.T "nav.cdnjs"}}</h3>
        <div class="muted small">{{.T "common.port"}}：<code>{{.Ports.Cdnjs}}</code></div>
        <div class="muted small" style="margin-top:8px;">{{.T "common.address"}}：<code>{{.CdnjsURL}}</code></div>
        {{if .CdnjsStatus.Status}}
          <div style="margin-top:8px;">
            {{template "serviceStatusPill" (statusCtx $ .CdnjsStatus)}}
            {{if and (eq .CdnjsStatus.Status "error") .CdnjsStatus.Error}}
              <span class="muted small" style="margin-left:8px;">{{.CdnjsStatus.Error}}</span>
            {{end}}
          </div>
        {{end}}
        {{if .CdnjsRedis.Status}}
          {{if eq .CdnjsRedis.Status "ok"}}
            <div style="margin-top:8px;"><span class="pill ok">{{.T "redis.ok"}} · {{.CdnjsRedis.LatencyMS}}ms · {{.CdnjsRedis.Addr}}</span></div>
          {{else if eq .CdnjsRedis.Status "error"}}
            <div style="margin-top:8px;"><span class="pill err">{{.T "redis.error"}} · {{.CdnjsRedis.Addr}}</span></div>
          {{else}}
            <div style="margin-top:8px;"><span class="pill">{{.T "redis.notConfigured"}}</span></div>
          {{end}}
        {{end}}
        <div class="btn-row">
          <a class="btn" href="/config/cdnjs">{{.T "common.configure"}}</a>
          <a class="btn" href="{{.CdnjsURL}}" target="_blank" rel="noreferrer">{{.T "common.open"}}</a>
          <a class="btn" href="{{.CdnjsHealthURL}}" target="_blank" rel="noreferrer">{{.T "common.health"}}</a>
        </div>
      </div>

      <div class="card">
        <h3>GitHub Raw</h3>
        <div class="muted small">{{.T "common.port"}}：<code>{{.Ports.Git}}</code></div>
        <div class="muted small" style="margin-top:8px;">{{.T "common.address"}}：<code>{{.GitURL}}</code></div>
        {{if .GitStatus.Status}}
          <div style="margin-top:8px;">
            {{template "serviceStatusPill" (statusCtx $ .GitStatus)}}
            {{if and (eq .GitStatus.Status "error") .GitStatus.Error}}
              <span class="muted small" style="margin-left:8px;">{{.GitStatus.Error}}</span>
            {{end}}
          </div>
        {{end}}
        {{if .GitInstances}}
          <div class="muted small" style="margin-top:10px;">{{.T "dashboard.extraInstances"}}：</div>
          <div style="margin-top:8px; display:grid; gap:8px;">
            {{range .GitInstances}}
              <div class="btn-row" style="margin-top:0;">
                <span class="pill"><code>{{.ID}}</code> · <code>{{.Port}}</code></span>
                {{template "serviceStatusPill" (statusCtx $ .Status)}}
                <a class="btn" href="/config/git?instance={{.ID}}">{{$.T "common.configure"}}</a>
                <a class="btn" href="{{.HealthURL}}" target="_blank" rel="noreferrer">{{$.T "common.health"}}</a>
              </div>
            {{end}}
          </div>
        {{end}}
        <div class="btn-row">
          <a class="btn" href="/config/git">{{.T "common.configure"}}</a>
          <a class="btn" href="{{.GitURL}}" target="_blank" rel="noreferrer">{{.T "common.open"}}</a>
          <a class="btn" href="{{.GitHealthURL}}" target="_blank" rel="noreferrer">{{.T "common.health"}}</a>
        </div>
      </div>
    </div>

    {{if .Warnings}}
      <div class="card">
        <h3>{{.T "dashboard.warningsTitle"}}</h3>
        <div class="muted small">{{.T "dashboard.warningsHint"}}</div>
        <ul style="margin:10px 0 0; padding-left: 18px;">
          {{range .Warnings}}
            <li style="margin:6px 0;">{{.}}</li>
          {{end}}
        </ul>
      </div>
    {{end}}
  </div>
{{end}}
