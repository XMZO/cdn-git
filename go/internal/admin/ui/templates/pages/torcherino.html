{{define "torcherino"}}
  <div class="grid">
    <div class="card">
      <h2>{{.Title}} <span class="muted small">{{.T "torcherino.tagline"}}</span></h2>
      <div class="muted small">{{.T "torcherino.subtitle"}}</div>
      <div class="btn-row">
        <span class="pill">{{.T "common.serviceUrl"}}：<code>{{.TorcherinoBaseURL}}</code></span>
        {{if .TorcherinoStatus.Status}}{{template "serviceStatusPill" (statusCtx $ .TorcherinoStatus)}}{{end}}
        <a class="btn" href="{{.TorcherinoHealthURL}}" target="_blank" rel="noreferrer">{{.T "common.openHealth"}}</a>
      </div>
      {{if and (eq .TorcherinoStatus.Status "error") .TorcherinoStatus.Error}}
        <div class="muted small" style="margin-top:10px;">{{.T "common.healthErrorPrefix"}}：{{.TorcherinoStatus.Error}}</div>
      {{end}}
    </div>

    <form class="form" method="post" action="/config/torcherino">
      <div class="card">
        <h3>{{.T "common.basicConfig"}}</h3>
        <div class="grid cols-2">
          <div class="field">
            <label>{{.T "common.port"}} <span class="key">ports.torcherino</span></label>
            <input type="text" name="torcherinoPort" value="{{.TorcherinoPortValue}}" placeholder="3000" />
            <div class="hint">{{.T "common.modifiedPortRestart"}}</div>
          </div>
          <div class="field">
            <label>{{.T "torcherino.defaultTargetLabel"}} <span class="key">DEFAULT_TARGET</span></label>
            <input type="text" name="defaultTarget" value="{{.DefaultTargetValue}}" placeholder="xxx.pages.dev" />
            <div class="hint">{{.T "torcherino.defaultTargetHint"}}</div>
          </div>
        </div>
        <div class="field">
          <label style="display:flex; gap:10px; align-items:center; font-weight:900;">
            <input type="checkbox" name="serviceEnabled" {{if not .Torcherino.Disabled}}checked{{end}} />
            <input type="hidden" name="serviceEnabled" value="0" />
            {{.T "common.enableService"}} <span class="key">torcherino.disabled</span>
          </label>
          <div class="hint">{{.T "torcherino.serviceToggleHint"}}</div>
        </div>
        <div class="field">
          <label style="display:flex; gap:10px; align-items:center; font-weight:900;">
            <input type="checkbox" name="forwardClientIp" {{if .Torcherino.ForwardClientIP}}checked{{end}} />
            <input type="hidden" name="forwardClientIp" value="0" />
            {{.T "torcherino.forwardClientIpLabel"}} <span class="key">torcherino.forwardClientIp</span>
          </label>
          <div class="hint">{{.T "torcherino.forwardClientIpHint"}}</div>
        </div>
      </div>

      <details class="card accordion" open>
        <summary>{{.T "common.preview"}} <span class="muted small">{{.T "common.previewNoRequest"}}</span></summary>
        <div class="body">
          <div class="muted small">{{.T "torcherino.previewHint"}}</div>
          <div class="grid cols-2" style="margin-top:10px;">
            <div class="field">
              <label>{{.T "common.host"}}</label>
              <input type="text" id="torcherinoPreviewHost" value="example.com" placeholder="example.com" />
              <div class="hint">{{.T "torcherino.matchLogicHintPrefix"}} <code>HOST_MAPPING[strings.ToLower(host)]</code>{{.T "torcherino.matchLogicHintSuffix"}} <code>DEFAULT_TARGET</code>{{.T "common.period"}}</div>
            </div>
            <div class="field">
              <label>{{.T "common.path"}}</label>
              <input type="text" id="torcherinoPreviewPath" value="/_hazuki/health" placeholder="/path" />
            </div>
          </div>

          <div class="field">
            <label>{{.T "torcherino.previewResult"}}</label>
            <div class="grid cols-2">
              <input type="text" id="torcherinoPreviewTarget" value="" class="readonly" readonly />
              <input type="text" id="torcherinoPreviewUrl" value="" class="readonly" readonly />
            </div>
            <div class="hint" id="torcherinoPreviewHint"></div>
          </div>
        </div>
      </details>

      <details class="card accordion" open>
        <summary>HOST_MAPPING <span class="muted small">{{.T "torcherino.hostMappingTagline"}}</span></summary>
        <div class="body">
          <div class="field">
            <label>{{.T "torcherino.hostMappingJsonLabel"}} <span class="key">HOST_MAPPING</span></label>
            <textarea id="hostMappingJson" name="hostMappingJson" data-json>{{.HostMappingJSON}}</textarea>
            <div class="hint hint-line">
              <span>{{.T "torcherino.hostMappingFormatPrefix"}} <code>{"a.com":"xxx.pages.dev"}</code>{{.T "common.semicolon"}}{{.T "torcherino.hostMappingFormatSuffix"}}{{.T "common.period"}}</span>
              <span class="spacer"></span>
              <button class="btn" type="button" data-format-json="#hostMappingJson">{{.T "common.formatJson"}}</button>
              <span class="json-msg" aria-live="polite"></span>
            </div>
          </div>
        </div>
      </details>

      <details class="card accordion" open>
        <summary>Worker Secret <span class="muted small">{{.T "common.optionalTag"}}</span></summary>
        <div class="body">
          <div class="grid cols-2">
            <div class="field">
              <label>{{.T "torcherino.workerSecretHeadersLabel"}} <span class="key">WORKER_SECRET_HEADERS</span></label>
              <input type="text" name="workerSecretHeaders" value="{{.WorkerSecretHeadersCsvValue}}" placeholder="x-forwarded-by-worker" />
              <div class="hint">{{.T "torcherino.workerSecretHeadersHint"}} <code>x-forwarded-by-worker</code>{{.T "common.period"}}</div>
            </div>
            <div class="field">
              <label>{{.T "torcherino.workerSecretKeyLabel"}} <span class="key">WORKER_SECRET_KEY</span></label>
              <input id="workerSecretKeyInput" type="password" name="workerSecretKey" value="" placeholder="{{if .SecretIsSet}}{{.T "secret.placeholderSetKeep"}}{{else}}{{.T "secret.placeholderEmptyDisable"}}{{end}}" />
              <div class="hint hint-line">
                <span class="spacer"></span>
                <label class="pill" style="font-weight:800;">
                  <input type="checkbox" data-toggle-password="#workerSecretKeyInput" />
                  {{.T "common.show"}}
                </label>
                <label style="display:flex; gap:10px; align-items:center; font-weight:900;">
                  <input type="checkbox" name="clearWorkerSecretKey" />
                  {{.T "common.clear"}}
                </label>
              </div>
            </div>
          </div>

          <div class="field">
            <label>{{.T "torcherino.workerSecretHeaderMapLabel"}} <span class="key">WORKER_SECRET_HEADER_MAP</span></label>
            <textarea id="workerSecretHeaderMapJson" name="workerSecretHeaderMapJson" data-json>{{.WorkerSecretHeaderMapJSONValue}}</textarea>
            <div class="hint hint-line">
              <span><code>__SET__</code> {{.T "torcherino.setPlaceholderHint"}}</span>
              <span class="spacer"></span>
              <button class="btn" type="button" data-format-json="#workerSecretHeaderMapJson">{{.T "common.formatJson"}}</button>
              <label style="display:flex; gap:10px; align-items:center; font-weight:900;">
                <input type="checkbox" name="clearWorkerSecretHeaderMap" />
                {{.T "common.clear"}}
              </label>
              <span class="json-msg" aria-live="polite"></span>
            </div>
          </div>
        </div>
      </details>

      <details class="card accordion" open>
        <summary>{{.T "torcherino.redisCacheTitle"}} <span class="muted small">{{.T "common.optionalTag"}}</span></summary>
        <div class="body">
          <div class="muted small">{{.T "torcherino.redisCacheHint"}}</div>
          <div class="grid cols-2" style="margin-top:10px;">
            <div class="field">
              <label style="display:flex; gap:10px; align-items:center; font-weight:900;">
                <input type="checkbox" name="redisCacheEnabled" {{if .RedisCacheEnabled}}checked{{end}} />
                <input type="hidden" name="redisCacheEnabled" value="0" />
                {{.T "torcherino.redisCacheEnabledLabel"}}
              </label>
            </div>
            <div class="field">
              <label>{{.T "torcherino.redisCacheMaxBodyBytesLabel"}}</label>
              <input type="text" name="redisCacheMaxBodyBytes" value="{{.RedisCacheMaxBodyBytesValue}}" placeholder="524288" />
              <div class="hint">{{.T "torcherino.redisCacheMaxBodyBytesHint"}}</div>
            </div>
          </div>

          <div class="grid cols-2">
            <div class="field">
              <label>{{.T "torcherino.redisCacheDefaultTTLSecondsLabel"}}</label>
              <input type="text" name="redisCacheDefaultTTLSeconds" value="{{.RedisCacheDefaultTTLSecondsValue}}" placeholder="0" />
              <div class="hint">{{.T "torcherino.redisCacheDefaultTTLSecondsHint"}}</div>
            </div>
            <div class="field">
              <label>{{.T "torcherino.redisCacheMaxTTLSecondsLabel"}}</label>
              <input type="text" name="redisCacheMaxTTLSeconds" value="{{.RedisCacheMaxTTLSecondsValue}}" placeholder="86400" />
              <div class="hint">{{.T "torcherino.redisCacheMaxTTLSecondsHint"}}</div>
            </div>
          </div>
        </div>
      </details>

      <div class="card">
        <h3>{{.T "common.save"}}</h3>
        <div class="btn-row">
          <button class="btn primary" type="submit">{{.T "common.save"}}</button>
        </div>
      </div>
    </form>
  </div>
{{end}}
