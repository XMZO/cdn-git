# Hazuki (Go) - 完整 .env 示例（高级/无 UI 部署用）
#
# 说明：
# - Hazuki 的“最终配置”保存在 SQLite（hazuki.db）里，并可通过 Web 面板修改。
# - 本文件用于“首次启动 seed 配置”（仅在数据库为空时生效），以及无 UI/无人值守场景。
# - 如果你修改了本文件但 Web 面板里看起来没变化：通常是因为数据库已有配置；需要删除/移动数据库文件（HAZUKI_DB_PATH）才会重新 seed。
#
# 用法：
#   cp .env.full.example .env
#   go run ./cmd/hazuki

# ===== Hazuki (Go 运行时) =====

# SQLite 文件路径（相对当前工作目录）。
HAZUKI_DB_PATH=./data/hazuki.db

# 用于加密敏感配置（GitHub Token / Worker Secret 等）。
# 建议设置强随机值并长期保持不变；如果 SQLite 里已保存了加密值（enc:v1:...），启动时必须提供同一个 HAZUKI_MASTER_KEY。
# 需要轮换时可在 Web 面板 /system 执行“轮换 HAZUKI_MASTER_KEY”（会重加密数据库）；轮换后请同步修改本文件并重启服务/容器。
HAZUKI_MASTER_KEY=change-me-to-a-long-random-string

# 可选：让 Web 面板轮换 HAZUKI_MASTER_KEY 时自动同步写入此 .env 文件路径（仅在文件可写时生效）。
# 留空：Hazuki 会按工作目录尽力尝试 go/.env 或 .env。
# Docker Compose 部署建议挂载本机 .env 到容器并设置：HAZUKI_ENV_FILE=/app/.env
HAZUKI_ENV_FILE=

# Session 过期时间（秒）
HAZUKI_SESSION_TTL_SECONDS=86400

# ===== SQLite 维护（可选）=====
#
# 说明：
# - config_versions 会记录每次保存的配置快照（用于 /config/versions 回滚）；频繁保存会导致 hazuki.db 增长。
# - SQLite 在 DELETE 后通常不会立刻缩小文件；需要 VACUUM 才会回收磁盘空间。

# config_versions 最大保留条数（<=0 表示不限制）
HAZUKI_CONFIG_VERSIONS_MAX=200

# 自动 VACUUM 周期（小时；<=0 表示禁用自动 VACUUM）
HAZUKI_DB_VACUUM_INTERVAL_HOURS=24

# 触发 VACUUM 的最小可回收空间（MB）
HAZUKI_DB_VACUUM_MIN_FREE_MB=16

# 触发 VACUUM 的最小可回收比例（0~1）
HAZUKI_DB_VACUUM_MIN_FREE_RATIO=0.20

# 可选：无人值守首次启动自动创建管理员（仅在 users 表为空时生效）。
# 如果不设置，也可以启动后访问 /setup 在 Web 端创建管理员。
HAZUKI_ADMIN_USERNAME=admin
HAZUKI_ADMIN_PASSWORD=change-me-please

# ===== cdnjs / jsDelivr 缓存（seed config; only used when DB is empty) =====

# 上游 CDN（一般不需要改）
ASSET_URL=https://cdn.jsdelivr.net

# /gh/<user>/... 的访问策略：
# - allowlist：只允许 ALLOWED_GH_USERS（留空=全部拒绝）
# - denylist：默认全部允许，仅拒绝 BLOCKED_GH_USERS（留空=全部允许）
GH_USER_POLICY=allowlist

# 允许使用 /gh/<user>/... 的 GitHub 用户白名单（逗号分隔，大小写不敏感）。
# 仅 allowlist 模式生效；为空则 /gh 全部拒绝。
ALLOWED_GH_USERS=XMZO,morieity

# denylist 模式下拒绝的 GitHub 用户黑名单（逗号分隔，大小写不敏感）。
# 仅 denylist 模式生效；为空则 /gh 全部允许。
BLOCKED_GH_USERS=

# 默认用户：请求 /<repo@ref/path> 会走 /gh/DEFAULT_GH_USER/<repo@ref/path>。
# 为空则短路径会返回 400。
DEFAULT_GH_USER=XMZO

# Redis（用于缓存；建议生产环境启用）
REDIS_HOST=127.0.0.1
REDIS_PORT=6379

# ===== git（seed config; only used when DB is empty) =====

# GitHub Personal Access Token（访问私有仓库时需要）。留空表示不带认证请求上游。
GITHUB_TOKEN=

# token 或 Bearer（通常用 token；GitHub API 常用 Bearer，但 raw 也可用）
GITHUB_AUTH_SCHEME=token

# 上游域名（默认 raw.githubusercontent.com）
UPSTREAM=raw.githubusercontent.com
UPSTREAM_MOBILE=raw.githubusercontent.com

# 默认仓库路径（至少 3 段）：/owner/repo/branch
UPSTREAM_PATH=/owner/repo/branch

# true=https, false=http
UPSTREAM_HTTPS=true

# 缓存策略（服务端响应 Cache-Control）
DISABLE_CACHE=false

# 不为空时将覆盖所有类型；留空则按内容类型使用下面默认值
CACHE_CONTROL=

# 图片/视频/音频/字体，或无法识别的类型
CACHE_CONTROL_MEDIA=public, max-age=43200000

# HTML/CSS/JS/JSON/XML/TOML/YAML 等
CACHE_CONTROL_TEXT=public, max-age=60

# 访问控制
BLOCKED_REGION=

# 封禁 IP（逗号分隔）。留空=不封禁。
# 注意：如果你想使用默认封禁（0.0.0.0,127.0.0.1），请删除这一行（让它“不存在”）。
BLOCKED_IP_ADDRESS=

# CORS
CORS_ORIGIN=*
CORS_ALLOW_CREDENTIALS=false
CORS_EXPOSE_HEADERS=Accept-Ranges, Content-Length, Content-Range, ETag, Cache-Control, Last-Modified

# HTML 内容替换（JSON 对象）。占位符：$upstream / $custom_domain
# 注意：因为 docker compose / godotenv 会对 $xxx 做变量展开，这里用 $$ 写法；Hazuki 会同时兼容 $ / $$ 占位符。
REPLACE_DICT={"$$upstream":"$$custom_domain"}

# ===== torcherino（seed config; only used when DB is empty) =====

# 默认上游域名（不带协议），当 HOST_MAPPING 未命中时使用。
DEFAULT_TARGET=

# 多域名映射（JSON 对象：host -> targetHost），只填域名，不要带 http(s)://
HOST_MAPPING={}

# Worker Secret（可选）：用于向上游注入验证 Header。
WORKER_SECRET_KEY=

# 自定义验证 Header 名称（逗号分隔）；为空则默认 x-forwarded-by-worker。
WORKER_SECRET_HEADERS=

# 不同 Header 使用不同值（JSON 对象）；会覆盖同名 Header 的 WORKER_SECRET_KEY 设置。
# 可用 "__SET__" 表示沿用已保存的值（适合在 Web 面板里编辑时避免泄露）。
WORKER_SECRET_HEADER_MAP={}

# ===== Sakuya / Oplist（seed config; only used when DB is empty) =====

# OpenList 地址（带 http(s)://）
OPLIST_ADDRESS=

# Token（同时用作 Authorization & 签名密钥）
OPLIST_TOKEN=

# 可选：公网地址（用于识别重定向回自身；留空则自动推断）
OPLIST_PUBLIC_URL=

# ===== Patchouli / HuggingFace（seed config; only used when DB is empty) =====

# 启用开关（默认只要 PATCHOULI_REPO 不为空就会启用；这里可强制关闭）
PATCHOULI_DISABLED=false

# 仓库类型：dataset | model | space
PATCHOULI_KIND=dataset

# 仓库：username/repo
PATCHOULI_REPO=

# 分支/Tag/Commit（留空默认 main）
PATCHOULI_REVISION=main

# HuggingFace Token（hf_...；用于私有仓库，作为 Authorization: Bearer <token>）
PATCHOULI_TOKEN=

# 可选：访问 Key（开启后客户端必须提供 ?key= 或 X-Patchouli-Key）
PATCHOULI_ACCESS_KEY=

# 禁用缓存：强制 Cache-Control: no-store（私有仓库建议开启）
PATCHOULI_DISABLE_CACHE=true

# 可选：允许跟随 302 的 Host 后缀（逗号分隔；留空使用默认值）
PATCHOULI_ALLOWED_REDIRECT_HOST_SUFFIXES=.huggingface.co,.hf.co,.cloudfront.net,.amazonaws.com
